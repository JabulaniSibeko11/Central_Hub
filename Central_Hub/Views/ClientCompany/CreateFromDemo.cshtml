@using Central_Hub.Models.ViewModels
@model CreateFromDemoViewModel


@{
    ViewData["Title"] = "Create Client Company";
    
    var demoRequestId = ViewBag.DemoRequestId;
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Declarify</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
   
    <link href="~/css/createfromdemocss.css" rel="stylesheet" />
</head>
<body>
    <!-- Decorative Backgrounds -->
    <div class="bg-glow"></div>
    <div class="bg-glow-2"></div>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="breadcrumb">
                <a asp-action="Index">Companies</a>
                <span class="breadcrumb-separator">›</span>
                <span>Create from Demo Request</span>
            </div>
            <h1 class="page-title">
                Create <span class="page-title-accent">Client Company</span>
            </h1>
            <p class="page-subtitle">
                Convert a demo request into a fully configured client organization. Review and edit the pre-filled information as needed.
            </p>
            @if (demoRequestId != null)
            {
                <div class="demo-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                    </svg>
                    Demo Request #@demoRequestId
                </div>
            }
        </div>

        <form asp-action="CreateFromDemo" method="post">
            <input type="hidden" asp-for="DemoRequestId" />
            <div class="form-container">
                <!-- Company Information Section -->
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
                            </svg>
                        </div>
                        Company Information
                    </h2>
                    <p class="section-description">Basic details about the organization - all fields are editable</p>
                </div>

                <div class="form-content">
                    <div class="prefilled-notice">
                        <svg class="prefilled-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="prefilled-text">✨ Information pre-filled from demo request - edit any field as needed</span>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label asp-for="Company.CompanyName" class="form-label">
                                Company Name
                                <span class="required-indicator">*</span>
                            </label>
                            <input asp-for="Company.CompanyName" class="form-input @(Model?.Company.CompanyName != null ? "prefilled" : "")"
                                   placeholder="e.g., City of Johannesburg" required />
                            <span asp-validation-for="Company.CompanyName" class="validation-message"></span>
                            <span class="edit-indicator">✏️ Editing</span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Company.RegistrationNumber" class="form-label">
                                Registration Number
                                <span class="required-indicator">*</span>
                            </label>
                            <input asp-for="Company.RegistrationNumber" class="form-input @(Model?.Company.RegistrationNumber != null ? "prefilled" : "")"
                                   placeholder="e.g., 2019/123456/07" required />
                            <span asp-validation-for="Company.RegistrationNumber" class="validation-message"></span>
                            <span class="form-help">Company or entity registration number</span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Company.EmailDomain" class="form-label">
                                Email Domain
                                <span class="required-indicator">*</span>
                            </label>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 10-2.636 6.364M16.5 12V8.25" />
                                </svg>
                                <input asp-for="Company.EmailDomain" class="form-input @(Model?.Company.EmailDomain != null ? "prefilled" : "")"
                                       placeholder="e.g., cityofjoburg.org.za" required />
                            </div>
                            <span asp-validation-for="Company.EmailDomain" class="validation-message"></span>
                            <span class="form-help">Only users with this email domain can access the system</span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Company.CompanyType" class="form-label">
                                Organization Type
                                <span class="required-indicator">*</span>
                            </label>
                            <select asp-for="Company.CompanyType" class="form-select @(Model?.Company.CompanyType != null ? "prefilled" : "")" required>
                                <option value="">Select organization type</option>
                                <option value="Municipality">Municipality</option>
                                <option value="GovernmentDepartment">Government Department</option>
                                <option value="StateOwnedEntity">State-Owned Entity</option>
                                <option value="PublicEntity">Public Entity</option>
                                <option value="PrivateSector">Private Sector</option>
                            </select>
                            <span asp-validation-for="Company.CompanyType" class="validation-message"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Company.Province" class="form-label">
                                Province
                            </label>
                            <select asp-for="Company.Province" class="form-select @(Model?.Company.Province != null ? "prefilled" : "")">
                                <option value="">Select province</option>
                                <option value="Gauteng">Gauteng</option>
                                <option value="Western Cape">Western Cape</option>
                                <option value="KwaZulu-Natal">KwaZulu-Natal</option>
                                <option value="Eastern Cape">Eastern Cape</option>
                                <option value="Free State">Free State</option>
                                <option value="Limpopo">Limpopo</option>
                                <option value="Mpumalanga">Mpumalanga</option>
                                <option value="Northern Cape">Northern Cape</option>
                                <option value="North West">North West</option>
                            </select>
                            <span asp-validation-for="Company.Province" class="validation-message"></span>
                        </div>

                        <div class="form-group">
                            <label asp-for="Company.EstimatedEmployeeCount" class="form-label">
                                Estimated Employee Count
                            </label>
                            <input asp-for="Company.EstimatedEmployeeCount" type="number"
                                   class="form-input @(Model?.Company.EstimatedEmployeeCount != null ? "prefilled" : "")"
                                   placeholder="e.g., 500" min="1" />
                            <span asp-validation-for="Company.EstimatedEmployeeCount" class="validation-message"></span>
                            <span class="form-help">Approximate number of employees who will use the system</span>
                        </div>
                    </div>

                    <div class="info-card">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                        </svg>
                        <div class="info-content">
                            <div class="info-title">Company Setup</div>
                            <div class="info-text">
                                Once created, a unique license key will be generated. The system will be accessible via the specified email domain only.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <!-- Administrator Information Section -->
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                            </svg>
                        </div>
                        Administrator Details
                    </h2>
                    <p class="section-description">Primary system administrator and compliance officer - all fields are editable</p>
                </div>

                <div class="form-content">
                    @if (Model.Administrator != null)
                    {
                        <div class="prefilled-notice">
                            <svg class="prefilled-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="prefilled-text">✨ Administrator information pre-filled - edit any field as needed</span>
                        </div>
                    }

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                First Name
                                <span class="required-indicator">*</span>
                            </label>
                            <input type="text" name="Administrator.FirstName" 
                                   class="form-input @(Model.Administrator.FirstName != null ? "prefilled" : "")"
                                   value="@Model.Administrator.FirstName" placeholder="e.g., John" required />
                            <span class="edit-indicator">✏️ Editing</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Surname
                                <span class="required-indicator">*</span>
                            </label>
                            <input type="text" name="Administrator.Surname" 
                                   class="form-input @(Model.Administrator.Surname != null ? "prefilled" : "")"
                                   value="@Model.Administrator.Surname" placeholder="e.g., Smith" required />
                            <span class="edit-indicator">✏️ Editing</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Email Address
                                <span class="required-indicator">*</span>
                            </label>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                                </svg>
                                <input type="email" name="Administrator.Email" 
                                       class="form-input @(Model.Administrator.Email != null ? "prefilled" : "")"
                                       value="@Model.Administrator.Email" placeholder="e.g., john.smith@company.com" required />
                            </div>
                            <span class="form-help">Must match the company email domain</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Phone Number
                                <span class="required-indicator">*</span>
                            </label>
                            <div class="input-with-icon">
                                <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                                </svg>
                                <input type="tel" name="Administrator.PhoneNumber" 
                                       class="form-input @(Model.Administrator.PhoneNumber != null ? "prefilled" : "")"
                                       value="@Model.Administrator.PhoneNumber" placeholder="e.g., +27 11 123 4567" required />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Job Title
                            </label>
                            <input type="text" name="Administrator.JobTitle" 
                                   class="form-input @(Model.Administrator.JobTitle != null ? "prefilled" : "")"
                                   value="@Model.Administrator.JobTitle" placeholder="e.g., Compliance Manager" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                Department
                            </label>
                            <input type="text" name="Administrator.Department" 
                                   class="form-input @(Model.Administrator.Department != null ? "prefilled" : "")"
                                   value="@Model.Administrator.Department" placeholder="e.g., Corporate Governance" />
                        </div>
                    </div>

                    <div class="info-card">
                        <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                        </svg>
                        <div class="info-content">
                            <div class="info-title">Administrator Privileges</div>
                            <div class="info-text">
                                The administrator will have full access to manage users, templates, compliance tracking, and system settings. They will receive login credentials via email.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden Demo Request ID -->
                @if (demoRequestId != null)
                {
                    <input type="hidden" name="DemoRequestId" value="@demoRequestId" />
                }

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Create Company & Generate License
                    </button>
                    <a asp-action="Index" class="btn-secondary">
                        Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>

    @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
        <script>
            // Email domain validation
            const emailDomainInput = document.querySelector('[name="EmailDomain"]');
            const adminEmailInput = document.querySelector('[name="Administrator.Email"]');

            if (adminEmailInput && emailDomainInput) {
                adminEmailInput.addEventListener('blur', function() {
                    const emailDomain = emailDomainInput.value.toLowerCase().trim();
                    const adminEmail = adminEmailInput.value.toLowerCase().trim();
                    
                    if (emailDomain && adminEmail) {
                        if (!adminEmail.endsWith('@@' + emailDomain)) {
                            adminEmailInput.setCustomValidity('Email must match the company domain (@@' + emailDomain + ')');
                            adminEmailInput.reportValidity();
                        } else {
                            adminEmailInput.setCustomValidity('');
                        }
                    }
                });
                
                // Clear validation when user starts typing
                adminEmailInput.addEventListener('input', function() {
                    adminEmailInput.setCustomValidity('');
                });
            }

            // Form submission confirmation
            document.querySelector('form').addEventListener('submit', function(e) {
                const companyName = document.querySelector('[name="CompanyName"]').value;
                if (!confirm(`Are you sure you want to create the company "${companyName}"?\n\n✓ A unique license key will be generated\n✓ Administrator credentials will be sent via email\n✓ The system will be immediately accessible`)) {
                    e.preventDefault();
                }
            });

            // Visual feedback for edited fields
            document.querySelectorAll('.form-input.prefilled, .form-select.prefilled').forEach(input => {
                const originalValue = input.value;
                
                input.addEventListener('input', function() {
                    if (this.value !== originalValue) {
                        this.style.borderColor = 'var(--color-warning)';
                        this.style.background = 'rgba(245, 158, 11, 0.05)';
                    } else {
                        this.style.borderColor = '';
                        this.style.background = '';
                    }
                });
            });
        </script>
    }
</body>
</html>
